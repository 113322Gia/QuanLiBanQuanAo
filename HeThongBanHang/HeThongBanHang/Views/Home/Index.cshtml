@model IPagedList<HeThongBanHang.Models.Product>
@using X.PagedList.Mvc.Core
@using X.PagedList

@{
    ViewData["Title"] = "Home Page";
    var isCategoryPage = ViewData["CategoryId"] != null;
    var categoryId = ViewData["CategoryId"] as int?;
}

@* có tích hợp PartialView nên dùng viewdata *@


<style>
    .product-thumb {
        position: relative;
        overflow: hidden;
    }

    .product-image {
        width: 100%;
        height: 200px; /* Cố định chiều cao cho hình ảnh */
        object-fit: cover; /* Đảm bảo hình ảnh giữ tỷ lệ mà không bị vỡ hoặc kéo dãn */
    }
</style>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
}

<div class="col-md-12">
    <div class="section-title">
        <h2 class="title">@((isCategoryPage) ? "Products by Category" : "Latest Products")</h2>
    </div>
</div>

@if (Model == null || !Model.Any())
{
    <div class="alert alert-warning">
        @if (isCategoryPage)
        {
            <span>No products found in this category.</span>
        }
        else
        {
            <span>No products available.</span>
        }
    </div>
}
else
{
    <div class="row" id="product-list">
        @foreach (var item in Model)
        {
            <div class="col-md-3 col-sm-6 col-xs-6">
                <div class="product product-single">
                    <div class="product-thumb">
                        <a asp-controller="Home" asp-action="QuickView" asp-route-id="@item.Id" class="quick-view-link">
                            <button class="main-btn quick-view">
                                <i class="fa fa-search-plus"></i> Quick view
                            </button>
                            <img src="@item.ImageUrl" alt="@item.Name" class="img-fluid product-image">
                        </a>
                    </div>

                    <div class="product-body">
                        <h3 class="product-price">@item.Price.ToString("N0") đ</h3>
                        <div class="product-rating">
                            @for (var i = 0; i < 5; i++)
                            {
                                <i class="fa fa-star@(i < 4 ? "" : "-o empty")"></i>
                            }
                        </div>
                        <h2 class="product-name"><a href="#">@item.Name</a></h2>

                        <form method="post" asp-controller="Cart" asp-action="AddToCart" asp-route-productId="@item.Id">
                            @Html.AntiForgeryToken()
                            <div class="product-btns">
                                <button class="main-btn icon-btn"><i class="fa fa-heart"></i></button>
                                <button class="main-btn icon-btn"><i class="fa fa-exchange"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="col-md-12 text-center mt-4">
        @Html.PagedListPager(Model, page => Url.Action("Index", new { page, id = categoryId }))
    </div>
}

<script>
    function submitForm(productId) {
        const form = document.getElementById(`form-${productId}`);
        if (form) {
            form.submit();
        }
    }


   
    // scroll khi click vào thể loại

            document.addEventListener("DOMContentLoaded", function () {
        const path = window.location.pathname.toLowerCase(); // Chuyển thành chữ thường để dễ so sánh, pathname là kiểu segment, search là kiểu query string ?id
        console.log("Current path:", path); // In ra đường dẫn để kiểm tra

        if (path === '/' || path.startsWith('/home/index') || path.includes('/home/bycategory/')) {
            const productList = document.getElementById('product-list');
            if (productList) {
                productList.scrollIntoView({ behavior: 'smooth' });
            }
        }
    });



</script>
